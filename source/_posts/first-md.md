---
title: 实际开发中的一些问题整理
date: 2019-08-19 15:12:30
tags:
category: shares
---
## 实际开发中的一些问题整理
最近在公司的移动端项目中负责开发了几个模块，遇到的几个问题记录一下。
项目使用的框架是`vue`配合`vux`。

第一个问题是在`mounted`方法中发起请求，写了两个请求，第二个请求需要第一个请求的返回值来拼接请求字段。当时第一时间的反应就是在`mouted`方法中直接调用这两个方法，这当然是行不通的。说明自己对异步函数还是过于陌生了，实际使用的经验太少。

项目中的请求方法对`axios`请求进行了一些封装，用法也比较相似，使用链式调用即可。
```
f1().then(res => {
    this.param = res.data
    f2(
        url:...+this.param...
    ).then(res => {
        doSomething...
    })
})
```
第二个问题是修改某个数值后没有引发视图的更新。具体场景与`vue`官方文档中提到的情况相似，即通过索引直接修改一个数组项时，vue不能检测到数组的变动并同步视图。
![博客1-1.png](https://i.loli.net/2019/08/19/VtPdebYliyKRk3m.png)

解决方案主要是使用`this.$set()`方法来修改数组的内容，在查看相关文档时感觉还是有必要阅读一下`vue`的项目源码，对其中的响应式原理深入了解。值得一提的是项目中有用到数组的`push`方法，却可以正常触发视图更新，这是因为`vue`将侦听的的数组的变异方法进行了包裹，所以包括`push()`在内的常用数组方法都可以正常触发视图的更新。

第三个问题是多个`<router-view>`导致渲染多次组件的问题，比较巧合的是在我还没遇到这个问题的时候，有位厉害的同事刚好分享过这类问题的情况，对我解决问题的过程起到了非常大的帮助。在写到详情页的展示组件时，从逻辑上我们很容易会将两个组件写成父子组件，但是这时给某些复用性比较强的组件添加`<router-view>`时就会出现问题。例如一个页面中使用了两次组件`A`，组件`A`内含有`<router-view>`，渲染内容为组件`B`，那么加上页面内的`<router-view>`，触发`A`组件内的事件时，`B`组件一共就会被渲染三次，他的`mounted`方法也会执行三次。我的解决方法就是将父子路由取消，保证页面中只有一个`<router-view>`存在。

另外还有一些小问题，比如在简单使用`go(-1)`返回上一层路由时，上一层的路由有些数据，如需要路由传值的数据，这个时候就无法得到，利用`vuex`来存值就可以解决这个问题。`vuex`按官方文档的说法，用在个人练习的小项目中有些大材小用和臃肿，不推荐使用，所以这次还是第一次使用到vuex的一些操作，但是通过`store`来保存全局状态的思路还是一样的。

除了这些以外，在项目的打包和相关配置上也还有很多要学习的地方。我们的项目使用的打包工具是`webpack`，创建项目的脚手架版本是`vue-cli2.0`，和`3.0`生成的`webpack`配置文件相差很大，如何配置好代理、跨域和打包文件的处理等都还不太了解。
在使用`npm run build`打包成功后，使用`cordova`将`vue`项目打包为原生app项目。`cordova`依赖`jdk8`和安卓环境，目前官网已经不支持单独安装SDK，所以直接安装`Android studio`来配置安卓相关环境。在执行`npm install cordova -g`全局安装好`cordova`之后就可以准备打包原生app了。其中遇到的问题主要有两个，第一个是下载相关插件时迟迟不成功，原因很简单，网络问题，需fq。第二个问题就是打包成功后发送`http`请求失败，原因是高版本的`Android`平台默认加强保护禁用`http`链接，[解决方法](https://www.jianshu.com/p/12ab6718e81c)。

还有一些细碎的问题，时间一久就容易忘记，记录的习惯希望自己可以慢慢养成吧。